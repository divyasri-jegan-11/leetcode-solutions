
# 1211. Queries Quality and Percentage

## üìù Problem Statement

### Table: `Queries`

| Column Name | Type    |
|-------------|---------|
| query_name  | varchar |
| result      | varchar |
| position    | int     |
| rating      | int     |

 - This table may have duplicate rows.
 - This table contains information collected from some queries on a database.
 - The position column has a value from 1 to 500.
 - The rating column has a value from 1 to 5. Query with rating less than 3 is a poor query.
 
 We define query `quality` as:
     The average of the ratio between query rating and its position.
We also define `poor query percentage` as:
     The percentage of all queries with rating less than 3.

Write a solution to find each `query_name`, the `quality` and `poor_query_percentage`.
Both `quality` and `poor_query_percentage` should be rounded to 2 decimal places.
Return the result table in **any order**. 

---

## üì• Example Input

Input : Transactions 

| id   | country | state    | amount | trans_date |
|------|---------|----------|--------|------------|
| 121  | US      | approved | 1000   | 2018-12-18 |
| 122  | US      | declined | 2000   | 2018-12-19 |
| 123  | US      | approved | 2000   | 2019-01-01 |
| 124  | DE      | approved | 2000   | 2019-01-07 |


Output: 

| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |
|----------|---------|-------------|----------------|--------------------|-----------------------|
| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |
| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |
| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |

---

## üí° SQL Solution

```sql


SELECT DATE_FORMAT (trans_date ,'%Y-%m') AS month, country,
       COUNT(*) AS trans_count,
       SUM(state='approved') AS approved_count,
       SUM(amount) AS trans_total_amount,
       SUM(IF(state ='approved',amount,0)) AS approved_total_amount
       FROM Transactions 
       GROUP BY 1,2;

SELECT query_name ,
       ROUND(AVG(rating / position),2) AS quality,
       ROUND(AVG(rating <3)* 100,2) AS poor_query_percentage
FROM Queries
GROUP BY 1;
