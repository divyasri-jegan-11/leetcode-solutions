# 1978. Employees Whose Manager Left the Company

## üìù Problem Statement

###  Table : `Employees`


| Column Name | Type     |
|-------------|----------|
| employee_id | int      |
| name        | varchar  |
| manager_id  | int      |
| salary      | int      |

 - In SQL, employee_id is the primary key for this table.
 - This table contains information about the employees, their salary, and the ID of their manager. Some employees do not have a manager (manager_id is null). 
 

Find the IDs of the employees whose salary is strictly less than $30000 and whose manager left the company. When a manager leaves the company, their information is deleted from the Employees table, but the reports still have their manager_id set to the manager that left.
### Example Input:

Input: 
Employee table:

| id | name  | salary | departmentId |
|----|-------|--------|--------------|
| 1  | Joe   | 85000  | 1            |
| 2  | Henry | 80000  | 2            |
| 3  | Sam   | 60000  | 2            |
| 4  | Max   | 90000  | 1            |
| 5  | Janet | 69000  | 1            |
| 6  | Randy | 85000  | 1            |
| 7  | Will  | 70000  | 1            |

Department table:

| id | name  |
|----|-------|
| 1  | IT    |
| 2  | Sales |

Output: 

| Department | Employee | Salary |
|------------|----------|--------|
| IT         | Max      | 90000  |
| IT         | Joe      | 85000  |
| IT         | Randy    | 85000  |
| IT         | Will     | 70000  |
| Sales      | Henry    | 80000  |
| Sales      | Sam      | 60000  |

Explanation: 
In the IT department:
- Max earns the highest unique salary
- Both Randy and Joe earn the second-highest unique salary
- Will earns the third-highest unique salary

In the Sales department:
- Henry earns the highest salary
- Sam earns the second-highest salary
- There is no third-highest salary as there are only two employees

## üí° SQL Solution

```sql

SELECT 
  d.name AS Department ,
  e.name AS Employee,
  e.salary  AS Salary 
  FROM 
  (SELECT *,
  DENSE_RANK() OVER (PARTITION BY departmentId ORDER BY salary DESC) AS salary_rank
  FROM Employee
  ) e
JOIN Department d ON e.departmentId = d.id 
WHERE e.salary_rank <=3;

SELECT e.employee_id FROM Employees AS e 
LEFT JOIN Employees AS Manager 
ON (e.manager_id = Manager.employee_id)
WHERE e.salary< 30000
 AND e.manager_id IS NOT NULL
 AND Manager.employee_id IS NULL
 ORDER BY 1;
