# 602. Friend Requests II: Who Has the Most Friends

## ðŸ“ Problem Statement

###  Table : `RequestAccepted`


| Column Name    | Type    |
|----------------|---------|
| requester_id   | int     |
| accepter_id    | int     |
| accept_date    | date    |

 - (requester_id, accepter_id) is the primary key (combination of columns with unique values) for this table.
 - This table contains the ID of the user who sent the request, the ID of the user who received the request, and the date when the request was accepted.
 

Write a solution to find the people who have the most friends and the most friends number.

The test cases are generated so that only one person has the most friends.


### Example Input:

Input: 
Insurance table:

| pid | tiv_2015 | tiv_2016 | lat | lon |
|-----|----------|----------|-----|-----|
| 1   | 10       | 5        | 10  | 10  |
| 2   | 20       | 20       | 20  | 20  |
| 3   | 10       | 30       | 20  | 20  |
| 4   | 10       | 40       | 40  | 40  |

Output: 

| tiv_2016 |
|----------|
| 45.00    |

Explanation: 
 - The first record in the table, like the last record, meets both of the two criteria.
 - The tiv_2015 value 10 is the same as the third and fourth records, and its location is unique.
 
 - The second record does not meet any of the two criteria. Its tiv_2015 is not like any other policyholders and its location is the same as the third record, which makes the third record fail, too.
 - So, the result is the sum of tiv_2016 of the first and last record, which is 45.

 - 
## ðŸ’¡ SQL Solution

```sql


WITH InsuranceCount AS (
    SELECT tiv_2016,
    COUNT(*) OVER(PARTITION BY tiv_2015) AS tiv_count,
    COUNT(*) OVER (PARTITION BY lat,lon ) AS city_count
    FROM Insurance
)
SELECT ROUND(SUM(tiv_2016),2) AS tiv_2016
FROM InsuranceCount 
WHERE tiv_count>1
AND city_count=1;
# Write your MySQL query statement below
WITH AllIds AS (
    SELECT requester_id AS id FROM RequestAccepted
    UNION ALL 
    SELECT accepter_id FROM RequestAccepted
)
SELECT id,
       COUNT(*) as num
       FROM AllIds
       GROUP BY 1
       ORDER BY 2 DESC
       LIMIT 1;
