# 585. Investments in 2016

## üìù Problem Statement

###  Table : `Insurance 

| Column Name | Type  |
|-------------|-------|
| pid         | int   |
| tiv_2015    | float |
| tiv_2016    | float |
| lat         | float |
| lon         | float |

 - pid is the primary key (column with unique values) for this table.
 - Each row of this table contains information about one policy where:
 - pid is the policyholder's policy ID.
 - tiv_2015 is the total investment value in 2015 and tiv_2016 is the total investment value in 2016.
 - lat is the latitude of the policy holder's city. It's guaranteed that lat is not NULL.
 - lon is the longitude of the policy holder's city. It's guaranteed that lon is not NULL.
 

Write a solution to report the sum of all total investment values in 2016 `tiv_2016`, for all policyholders who:

have the same `tiv_2015` value as one or more other policyholders, and
are not located in the same city as any other policyholder (i.e., the (`lat, lon`) attribute pairs must be unique).
Round `tiv_2016` to two decimal places.
### Example Input:

Input: 
Employees table:

| employee_id | name      | manager_id | salary |
|-------------|-----------|------------|--------|
| 3           | Mila      | 9          | 60301  |
| 12          | Antonella | null       | 31000  |
| 13          | Emery     | null       | 67084  |
| 1           | Kalel     | 11         | 21241  |
| 9           | Mikaela   | null       | 50937  |
| 11          | Joziah    | 6          | 28485  |

Output: 

| employee_id |
|-------------|
| 11          |


Explanation: 
 - The employees with a salary less than $30000 are 1 (Kalel) and 11 (Joziah).
 - Kalel's manager is employee 11, who is still in the company (Joziah).
 - Joziah's manager is employee 6, who left the company because there is no row for employee 6 as it was deleted.
## üí° SQL Solution

```sql


SELECT e.employee_id FROM Employees AS e 
LEFT JOIN Employees AS Manager 
ON (e.manager_id = Manager.employee_id)
WHERE e.salary< 30000
 AND e.manager_id IS NOT NULL
 AND Manager.employee_id IS NULL
 ORDER BY 1;

WITH InsuranceCount AS (
    SELECT tiv_2016,
    COUNT(*) OVER(PARTITION BY tiv_2015) AS tiv_count,
    COUNT(*) OVER (PARTITION BY lat,lon ) AS city_count
    FROM Insurance
)
SELECT ROUND(SUM(tiv_2016),2) AS tiv_2016
FROM InsuranceCount 
WHERE tiv_count>1
AND city_count=1;
